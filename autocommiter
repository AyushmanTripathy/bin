#/bin/sh

LIMIT="5"
DATE=$(date +%D)
LOG="$XDG_DATA_HOME/.autocommiter/log.txt"

push(){
  cd $XDG_DATA_HOME/.autocommiter
  update-remote
  git add .
  git commit -m $DATE --quiet
  git push origin master --quiet
}

LINE=$(tail -n 1 $LOG)
REC_DATE=$(echo $LINE | cut -d' ' -f1)

if [ $DATE = $REC_DATE ]
then
  TIMES=$(echo $LINE | cut -d' ' -f2)
  if [ $TIMES != $LIMIT ]
  then
    echo "$DATE $(( $TIMES + 1 ))" >> $LOG
    push
  fi
else
  echo "$DATE 1" >> $LOG
  push
fi
